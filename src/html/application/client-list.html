<!doctype html>
<html lang="en">
  <!-- [Head] start -->
  <head>
    <link rel="stylesheet" href="../assets/css/plugins/style.css" />
    @@include('../layouts/head-page-meta.html', {'title': 'Customer List'}) @@include('../layouts/head-css.html')
  </head>
  <!-- [Head] end -->
  <!-- [Body] Start -->
  <body @@bodySetup>
    @@include('../layouts/layout-vertical.html')

    <!-- [ Main Content ] start -->
    <div class="pc-container">
      <div class="pc-content">
        <div class="card-header" style="padding-bottom: 20px;">
          <h3>Client List</h3>
        </div>
        <!-- [ Main Content ] start -->
        <div class="row">
          <!-- [ sample-page ] start -->
          <div class="col-sm-12">
            <div class="card table-card">
              <div class="card-body">
                <div class="text-end p-4 pb-sm-2">
                  <a href="/application/new-user-profile.html" class="btn btn-primary d-inline-flex align-items-center gap-2">
                    <i class="ti ti-plus f-18"></i> Add Client
                  </a>
                </div>
                <div class="table-responsive">
                  <table class="table table-hover" id="pc-dt-simple">
                    <thead>
                      <tr>
                        <th>#</th>
                        <th>Client Name</th>
                        <th>Contact</th>
                        <th>Visa Service</th>
                        <th>Status</th>
                        <th class="text-center">Actions</th>
                      </tr>
                    </thead>
                    <tbody>
                      <tr>
                        <td>1</td>
                        <td>
                          <div class="row">
                            <div class="col-auto">
                              <img src="../assets/images/user/avatar-1.jpg" alt="user-image" class="wid-40 rounded-circle" />
                            </div>
                            <div class="col">
                              <h6 class="mb-0">Faith Chris Henry</h6>
                              <p class="text-muted f-12 mb-0">faith@gmail.com</p>
                            </div>
                          </div>
                        </td>
                        <td>+1 (247) 849-6968</td>
                        <td>EB1</td>
                        <td><span class="badge bg-light-success rounded-pill f-12">Completed</span> </td>
                        <td class="text-center">
                          <ul class="list-inline me-auto mb-0">
                            <li class="list-inline-item align-bottom" data-bs-toggle="tooltip" title="View">
                              <a href="#" class="avtar avtar-xs btn-link-secondary btn-pc-default" data-bs-toggle="modal" data-bs-target="#customer-modal">
                                <i class="ti ti-eye f-18"></i>
                              </a>
                            </li>
                            <li class="list-inline-item align-bottom" data-bs-toggle="modal" title="Review">
                              <a href="#" onclick="scheduleGoogleMeet(this.dataset.email, this.dataset.formName, this.dataset.formLink)" class="avtar avtar-xs btn-link-success btn-pc-default" data-email="faith@gmail.com" data-form-name="VISA Form" data-form-link="https://form-url">
                                <i class="ti ti-calendar f-18" style></i>
                              </a>
                            </li>
                            <li class="list-inline-item align-bottom" data-bs-toggle="modal" title="Nudge">
                              <a href="#" onclick="nudgeClient(this.dataset.email)" class="avtar avtar-xs btn-link-success btn-pc-default" data-email="faith@gmail.com">
                                <i class="ti ti-clock f-18" style="color: red;"></i>
                              </a>
                            </li>
                          </ul>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
          <!-- [ sample-page ] end -->
        </div>
        <!-- [ Main Content ] end -->
      </div>
    </div>
    <div class="modal fade" id="customer-modal" data-bs-keyboard="false" tabindex="-1" aria-hidden="true">
      <div class="modal-dialog modal-lg modal-dialog-centered modal-dialog-scrollable">
        <div class="modal-content">
          <div class="modal-header border-0 pb-0">
            <h5 class="mb-0">Client Details</h5>
            <a href="#" class="avtar avtar-s btn-link-danger btn-pc-default ms-auto" data-bs-dismiss="modal">
              <i class="ti ti-x f-20"></i>
            </a>
          </div>
          <div class="modal-body">
            <div class="row">
              <div class="col-lg-4">
                <div class="card">
                  <div class="card-body position-relative">
                    <div class="position-absolute end-0 top-0 p-3">
                      <span class="badge bg-primary">In Progress</span>
                    </div>
                    <div class="text-center mt-3">
                      <div class="chat-avtar d-inline-flex mx-auto">
                        <img class="rounded-circle img-fluid wid-60" src="../assets/images/user/avatar-5.jpg" alt="User image" />
                      </div>
                      <h5 class="mb-0">Faith Henry Chris</h5>
                      <p class="text-muted text-sm">Senior Data Consultant</p>
                      <hr class="my-3 border border-secondary-subtle" />
                      <div class="d-inline-flex align-items-center justify-content-between w-100 mb-3">
                        <i class="ti ti-mail"></i>
                        <p class="mb-0">faithie@gmail.com</p>
                      </div>
                      <div class="d-inline-flex align-items-center justify-content-between w-100 mb-3">
                        <i class="ti ti-phone"></i>
                        <p class="mb-0">+1 (247) 849-6968</p>
                      </div>
                      <div class="d-inline-flex align-items-center justify-content-between w-100">
                        <i class="ti ti-link"></i>
                        <a href="#" class="link-primary">
                          <p class="mb-0">https://form-url</p>
                        </a>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="col-lg-8">
                <div class="card">
                  <div class="card-header">
                    <h5>Personal Details</h5>
                  </div>
                  <div class="card-body">
                    <ul class="list-group list-group-flush">
                      <li class="list-group-item px-0 pt-0">
                        <div class="row">
                          <div class="col-md-6">
                            <p class="mb-1 text-muted">Full Names</p>
                            <h6 class="mb-0">Faith Henry Chris</h6>
                          </div>
                        </div>
                      </li>
                      <li class="list-group-item px-0">
                        <div class="row">
                          <div class="col-md-6">
                            <p class="mb-1 text-muted">Visa Service</p>
                            <h6 class="mb-0">EB1</h6>
                          </div>
                          <div class="col-md-6">
                            <p class="mb-1 text-muted">Gender</p>
                            <h6 class="mb-0">Female</h6>
                          </div>
                        </div>
                      </li>
                      <li class="list-group-item px-0 pb-0">
                        <p class="mb-1 text-muted">Date of Birth</p>
                        <h6 class="mb-0">November 10th, 1997</h6>
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    @@include('../layouts/footer-block.html') @@include('../layouts/footer-js.html')
    <script src="../assets/js/plugins/simple-datatables.js"></script>
    <script>
      const dataTable = new simpleDatatables.DataTable('#pc-dt-simple', {
        sortable: false,
        perPage: 5
      });
      function scheduleGoogleMeet(clientEmail, formName, formLink) {
        const payload = new FormData();
        payload.append('client_email', clientEmail);
        payload.append('form_name', formName);
        payload.append('form_link', formLink);
      
        fetch('http://127.0.0.1:5000/generate_meet', {
          method: 'POST',
          body: payload,
        })
          .then((response) => {
            if (!response.ok) {
              throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
          })
          .then((data) => {
            if (data.status === 'success') {
              alert('Google Meet link generated successfully!');
              window.open(data.link, '_blank'); // Opens the generated meeting link
            } else {
              alert('Failed to generate the link. Please try again.');
            }
          })
          .catch((error) => {
            console.error('Error:', error);
            alert('An error occurred while generating the link. Please check the console for details.');
          });
      }
      
      function nudgeClient(email) {
        const payload = new FormData();
        payload.append('email', email);
      
        fetch('http://127.0.0.1:5000/nudge_client', {
          method: 'POST',
          body: payload,
        })
          .then((response) => {
            if (!response.ok) {
              throw new Error(`HTTP error! status: ${response.status}`);
            }
            return response.json();
          })
          .then((data) => {
            if (data.status === 'success') {
              alert('Nudge mail has been sent successfully!');
            } else {
              alert('Failed to send the nudge mail. Please try again.');
            }
          })
          .catch((error) => {
            console.error('Error:', error);
            alert('An error occurred while sending the nudge mail. Please check the console for details.');
          });
      }
      
    </script>
    @@include('../layouts/customizer.html')
  </body>
  <!-- [Body] end -->
</html>
